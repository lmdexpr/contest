# AHC051 - Probabilistic Waste Sorting

## ストーリー
高橋市では現在、新たなごみ処理場を建設中である。
この処理場にはさまざまな種類のごみが運び込まれるため、処理を行う前に分別する必要がある。分別は、例えば磁石によって鉄を含むものとそれ以外を分けるなど、いくつかの機器を使って行うことができる。
ただし、分別器は確率的にごみを二つの経路に振り分ける仕組みであり、ごみの種類を正確に識別することはできない。
そのため、例えば形状によって缶とそれ以外を分けた後に、磁石によってアルミ缶とスチール缶を分けるなど、複数の分別器を適切に組み合わせることが必要である。
複数の分別器をうまく組み合わせることにより、できるだけ正確にごみの分別を行ってほしい。

## 問題文

N 種類のごみを分別して処理するためのごみ処理場を建設中である。ごみ処理場は2次元平面上の 0≤x≤10^4、0≤y≤10^4 からなる正方形領域として表現される。
この処理場にはさまざまな種類のごみが**ごみ搬入口**から運び込まれる予定であり、**処理装置**と**分別器**を設置し、それらを**ベルトコンベア**で結ぶことにより、できるだけ正確に分別を行った上で処理を行うことができるようにしたい。

### ごみ搬入口

処理場内に一つだけ存在し、座標は (0,5000) である。
搬入口からは一本のベルトコンベアを伸ばし、処理装置または分別器へとごみを運ぶ。

### 処理装置

処理場内に各ごみの種類ごとに処理装置を 1 台ずつ設置する。
各ごみを正しい処理装置に運び込むことが目的である。

ごみ処理場内には処理装置を設置できるスペースがちょうど N 箇所存在し、i 番目の設置場所の座標は (x^d_i,y^d_i) である。
どの設置場所にどの種類のごみの処理装置を設置するかは自由に選ぶことができる。

### 分別器

K 種類のごみ自動分別器がある。**同じ分別器を複数設置しても構わない。**

各分別器は運び込まれたごみを確率的に2つの経路のいずれかへと振り分け、出口1または出口2から運び出す。
このとき、どの経路に進むかはごみの種類ごとに定まった確率に従う。
i 番目の自動分別器が種類 j のごみを出口1から運び出す確率は p_{i,j} であり、出口2から運び出す確率は 1-p_{i,j} である。

ごみ処理場内には分別器を設置するためのスペースが M 箇所存在し、i 番目の設置場所の座標は (x^s_i,y^s_i) である。
各スペースには高々 1 台の分別器を設置することができる。

### ベルトコンベア

ごみ搬入口ならびに各分別器の二つの出口からはベルトコンベアを伸ばし、処理装置もしくは他の分別器へとごみを運ぶ必要がある。
ベルトコンベアは始点と終点を結ぶ線分として敷設され、端点をひとつも共有しない二つのベルトコンベアは共有点を持ってはならない。
この条件では、分別器の二つの出口の行き先が同じであることも許容されている。

ごみ搬入口・処理装置・分別器を頂点、ベルトコンベアを辺とした有向グラフを考えたとき、有向グラフに閉路（自己閉路を含む）が存在してはならない。

## 入力

入力は以下の形式で標準入力から与えられる。

```
N M K
x^d_0 y^d_0
⋮
x^d_{N-1} y^d_{N-1}
x^s_0 y^s_0
⋮
x^s_{M-1} y^s_{M-1}
p_{0,0} p_{0,1} ... p_{0,N-1}
⋮
p_{K-1,0} p_{K-1,1} ... p_{K-1,N-1}
```

### 制約

- ごみの種類数 N は 5≤N≤20 を満たす。
- 分別器設置場所の個数 M は 10N≤M≤50N を満たす。
- 分別器の個数 K は N≤K≤4N を満たす。
- i 番目の処理装置設置場所の座標 (x^d_i,y^d_i) は、0≤x^d_i,y^d_i≤10^4 を満たす整数である。
- i 番目の分別器設置場所の座標 (x^s_i,y^s_i) は、0≤x^s_i,y^s_i≤10^4 を満たす整数である。
- 各分別器の確率 p_{i,j} は、0≤p_{i,j}≤1 を満たす実数である。
- 全ての設置場所（処理装置・分別器・ごみ搬入口）の座標は互いに異なる。

## 出力

ベルトコンベアの行き先を、以下のように番号で表現する。

- 行き先が i 番目の処理装置設置場所である場合は i
- 行き先が i 番目の分別器設置場所である場合は N+i

i 番目の処理装置設置場所に設置する処理装置の番号を d_i (0≤d_i≤N-1) とする。
ごみ搬入口から出るベルトコンベアの行き先を表す番号を s (0≤s≤N+M−1) とする。

出力は以下の形式で行う。

```
d_0 d_1 ... d_{N-1}
s
```

続けて、M 行を以下の通りに出力する。

- i 行目は、i 番目の分別器設置場所の状態に応じて以下のように出力する。
- 分別器を設置しない場合
    - `−1`
- k 番目 (0≤k≤K−1) の分別器を設置し、出口1から出るベルトコンベアの行き先を表す番号が v_1、出口2から出るベルトコンベアの行き先を表す番号が v_2 である場合（0≤v_1, v_2 ≤N+M−1）
    - `k v_1 v_2`

## 実行時間制限・メモリ制限

- 実行時間制限: 2 sec
- メモリ制限: 1024 MiB

## 得点

各テストケースにおいて、N 種類のごみがごみ搬入口から運び込まれ、それぞれの種類について 1000 個ずつのごみが処理される。
各ごみが正しい処理装置で処理された場合には得点 1 が得られる。
間違った処理装置で処理された場合には得点 0 となる。

最終順位はコンテスト終了後に実施されるより多くの入力に対するシステムテストにおける得点で決定される。

i 種類目のごみが、それに対応する処理装置に最終的に運び込まれる確率を q_i と定義する。 このとき、以下の絶対スコアが得られる：

round(10^9 × 1/N * ∑_{i=0}^{N−1} (1 − q_i))

**絶対スコアは小さければ小さいほど良い。**

各テストケース毎に、round(10 9 × 全参加者中の最小絶対スコア / 自身の最小絶対スコア) の相対評価スコアが得られ、その和が提出の得点となる。

最終順位はコンテスト終了後に実施されるより多くの入力に対するシステムテストにおける得点で決定される。 暫定テスト、システムテストともに、一部のテストケースで不正な出力や制限時間超過をした場合、そのテストケースの相対評価スコアは0点となり、そのテストケースにおいては「全参加者中の最小絶対スコア」の計算から除外される。 システムテストは CE 以外の結果を得た一番最後の提出に対してのみ行われるため、最終的に提出する解答を間違えないよう注意せよ。

## テストケース数

- 暫定テスト: 50個
- システムテスト: 2000個

## ヒント: 線分の交差判定について

線分 p_1p_2 と q_1q_2 において、端点をひとつも共有しない場合の交差は、次のように判定できる：
両線分が交差するのは、p_1,p_2 が直線 q_1q_2 に対して異なる側にあり、かつ q_1,q_2 が直線 p_1p_2 に対して異なる側にある場合である。

直線に対する位置関係は外積を用いて判定できる：
点 q が直線 p_1p_2 に対してどちら側にあるかは、ベクトル p_1p_2 とベクトル p_1q の外積 (p_2-p_1)×(q-p_1) の符号で判定できる。
